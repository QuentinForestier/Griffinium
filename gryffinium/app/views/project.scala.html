@import play.mvc.Http.Request

@(uuid: String)(implicit request: Request)

@main("Diagram"){

    <h1>Chat room nÂ°@uuid</h1>
    <input type="text" id="sender"/>

    <ul id="chat" style="text-decoration: none">

    </ul>
    <input type="text" id="message" name="message"  />
    <button onclick="sendMessage()">Send</button>

    <script>
            const socket = new WebSocket('ws://localhost:9000/socket/@uuid');

            const messageInput = document.getElementById('message');
            const chat = document.getElementById('chat');


            function sendMessage() {
                socket.send(JSON.stringify({
                    'message': messageInput.value,
                    'sender': document.getElementById('sender').value,
                    'type': 'ChatMessage'
                }));

                messageInput.value = '';
            }

            socket.onopen = function() {

                socket.onmessage = function(event){
                    let li = document.createElement('li');
                    let message = JSON.parse(event.data);
                    li.innerHTML = message.sender + ': ' + message.message;
                    chat.appendChild(li);
                };
            }
    </script>
}